# 🕵️‍♂️ マーダーミステリーGM支援Bot 操作マニュアル

このBotは、Discord上で行うマーダーミステリー（マダミス）の進行を補助するツールです。
会場の設営、配役、密談からの集合、撤収作業を自動化します。
※BOTの実装方法2関しては下記URLのサイトを参考

[BOTの実装方法](https://qiita.com/als/items/cb078585ac212285c671)

---

## 📋 目次
1. [事前準備（導入時のみ）](#1-事前準備導入時のみ)
2. [セッション開始前（設営・配役）](#2-セッション開始前設営配役)
3. [ゲーム中の進行（タイマー・移動）](#3-ゲーム中の進行タイマー移動)
4. [セッション終了後（片付け・ログ消去）](#4-セッション終了後片付けログ消去)
5. [コマンド一覧表](#5-コマンド一覧表)

---

## 1. 事前準備（導入時のみ）

Botをサーバーに入れたら、まずは管理者（GM）の設定を行います。

### 👑 GMを設定する
!setgm @自分

* **機能:** 指定したユーザーに「GM」ロールを付与します。
* **特権:** 全ての隠し部屋（テキスト・ボイス）の閲覧権限を持ち、移動コマンドの対象外になります。

### 🎧 サブアカウント（録音・配信など）を設定する
!setsub @サブ垢の名前

* **機能:** 指定したユーザーに「GMサブ」ロールを付与します。
* **特権:** GMと同様に全部屋に入室でき、移動コマンドで飛ばされなくなります。

> **⚠️ 重要:** Botのロール（`MadamisBot`など）は、サーバー設定のロール一覧で**一番上**に配置してください。そうしないと権限エラーになります。

---

## 2. セッション開始前（設営・配役）

### 🏗️ 会場をセットアップする
!setup キャラ名1 キャラ名2 ...

* **使用例:** `!setup 探偵 犯人 執事 メイド`
* **機能:** 以下のチャンネルを作成・設定します。
    * **常設部屋（なければ作成、あれば流用）:**
        * `マダミス会場`（カテゴリー）
        * `#全体議論`（全員公開テキスト）
        * `#gm控室`（非公開テキスト）
        * 🔊 `広間`（全員公開ボイス）
        * 🔊 `密談1` `密談2`（全員公開ボイス）
    * **個別部屋（毎回新規作成）:**
        * 入力したキャラクター名ごとの「専用テキストチャンネル」と「ロール」を作成します（非公開設定）。

### 🎭 役を割り当てる（配役）
!cast 役名 @プレイヤー

* **使用例:** `!cast 探偵 @田中`
* **機能:** プレイヤーにその役のロールを付与し、専用チャンネルへのリンクを案内します。
* **効果:** そのプレイヤーだけが「自分の部屋」を見られるようになります。

---

## 3. ゲーム中の進行（タイマー・移動）

### ⏳ タイマー（参加者メンション・途中経過あり）
!timer 分数 メモ

* **使用例:** `!timer 10 全体議論`
* **機能:** 指定した時間後に通知します。
* **通知先:** ゲームに参加しているキャラクター役職を持っている人だけにメンションします。
* **通知タイミング:**
    * **4分以上:** 「半分（折り返し）」と「残り1分」で通知。
    * **2分以上:** 「残り1分」で通知。

### 🛑 タイマー停止
!stop

* **機能:** 現在動いているタイマー（`!timer` または `!gather`）を強制停止します。

### 🏃 集合・移動（2つのモード）
Botが状況に合わせて「呼び出し」か「全員集合」かを自動判断します。

#### ① 特定の人を呼び出す（自動帰還あり）
**「密談部屋」などに呼び出し、時間が来たら元の場所へ戻します。**
!gather @役職 分数 [行き先]

* **使用例1（密談1へ）:** `!gather @探偵 5`
    * 行き先省略時は「密談1」になります。
* **使用例2（場所指定）:** `!gather @犯人 3 密談2`
    * 犯人を「密談2」へ3分間呼び出します。
* **動作:** 対象者を指定の部屋へ移動させ、時間が来たら**自動で元の部屋へ戻します**。

#### ② 全員を集める（戻らない）
**議論終了時などに、全員を「広間」へ集めます。**
!gather 分数

* **使用例:** `!gather 10`
* **動作:** 密談部屋にいる全員を強制的に「広間」へ移動させます。
* **注意:** 時間が来ても**自動では戻りません**（広間で解散）。

> **残り1分通知:** どちらのモードでも、移動先にいるプレイヤーに対して「残り1分」のアナウンスを行います。

---

## 4. セッション終了後（片付け・ログ消去）

### 🗑️ 片付け（リセット）
!cleanup

* **機能:** セッションの情報をリセットし、ログを消去します。
* **消えるもの:**
    * 今回作成した「キャラクター個別のテキスト部屋」
    * 今回作成した「キャラクターのロール」
* **残るもの:**
    * カテゴリー、全体議論、GM控室、広間、密談部屋
* **🧹 ログ消去（重要）:**
    * 残る部屋（`#gm控室` `#全体議論` `広間`）の**会話ログは全て消去（パージ）**されます。
    * 次のセッションのために履歴を真っ白にします。

---

## 5. コマンド一覧表

| コマンド | 引数 | 説明 |
| :--- | :--- | :--- |
| `!setgm` | `@ユーザー` | GMロール（全権限・移動無効）を付与。 |
| `!setsub` | `@ユーザー` | GMサブロール（全権限・移動無効）を付与。 |
| `!setup` | `役名1 役名2...` | 会場構築。キャラ部屋作成。常設部屋は維持。 |
| `!cast` | `役名 @ユーザー` | プレイヤーに役職を割り当てる。 |
| `!timer` | `分数 (メモ)` | 参加者メンション付きタイマー。 |
| `!stop` | なし | 実行中のタイマーを強制停止。 |
| `!gather` | `@役職 分数 [行先]` | **呼び出しモード**（指定部屋へ移動→自動帰還）。 |
| `!gather` | `分数` | **全員集合モード**（全員広間へ移動→戻らない）。 |
| `!cleanup` | なし | キャラ部屋・ロール削除。常設部屋のログ全消去。 |
